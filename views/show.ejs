<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title><%= filename %> â€¢ Task</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { sans: ['Inter', 'ui-sans-serif', 'system-ui'], mono: ['ui-monospace','SFMono-Regular','Menlo','monospace'] },
          colors: { bg: '#0b0f17', card: 'rgba(255,255,255,0.06)', border: 'rgba(255,255,255,0.08)' },
          boxShadow: { soft: '0 10px 30px rgba(0,0,0,0.35)' }
        }
      }
    }
  </script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;800&display=swap" rel="stylesheet">
  <style>.glass{backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px)}</style>
</head>
<body class="min-h-screen bg-[radial-gradient(60%_60%_at_50%_0%,_#111827_0%,_#0b0f17_60%)] text-white font-sans">

  <!-- Header -->
  <header class="sticky top-0 z-30 border-b border-border/60 bg-bg/70 glass">
    <div class="mx-auto max-w-4xl px-4 py-4 flex items-center justify-between gap-3">
      <a href="/" class="text-sm text-blue-400 hover:text-blue-300">&larr; Back to tasks</a>
      <div class="flex items-center gap-2">
        <span class="hidden sm:inline rounded-full border border-border px-2 py-0.5 text-[10px] uppercase tracking-wider text-zinc-300">.txt</span>
      </div>
    </div>
  </header>

  <!-- Main -->
  <main class="mx-auto max-w-4xl px-4 py-10">
    <article class="glass rounded-2xl border border-border p-6 md:p-8 shadow-soft">
      <h1 class="text-2xl md:text-3xl font-extrabold tracking-tight break-words"><%= filename %></h1>

      <!-- Toolbar -->
      <div class="mt-4 flex flex-wrap items-center gap-2 text-sm">
        <button id="copy" class="rounded-xl bg-blue-600 hover:bg-blue-500 px-4 py-2 font-medium">Copy Text</button>
        <a id="download" href="/files/<%= encodeURIComponent(filename) %>/download" class="rounded-xl border border-border px-4 py-2 hover:bg-zinc-800/60">Download</a>
        <button id="print" class="rounded-xl border border-border px-4 py-2 hover:bg-zinc-800/60">Print</button>
        <button id="copyLink" class="rounded-xl border border-border px-4 py-2 hover:bg-zinc-800/60">Copy Link</button>

        <span class="mx-2 h-5 w-px bg-border/80 hidden sm:inline-block"></span>

        <label class="inline-flex items-center gap-2 rounded-xl border border-border px-3 py-2 hover:bg-zinc-800/60 cursor-pointer">
          <input id="wrap" type="checkbox" class="accent-blue-600" checked>
          <span>Wrap lines</span>
        </label>

        <div class="ml-auto flex items-center gap-2">
          <span class="text-zinc-400">Font</span>
          <input id="fontSize" type="range" min="12" max="22" value="16" class="w-28 accent-blue-600">
        </div>
      </div>

      <!-- Content -->
      <div class="mt-6">
        <pre id="content"
             class="whitespace-pre-wrap leading-7 text-zinc-200 bg-zinc-900/40 rounded-xl p-5 border border-border font-mono text-[16px] overflow-auto"><%= filedata %></pre>
      </div>
    </article>
  </main>

  <!-- Toast -->
  <div id="toast" class="fixed bottom-4 left-1/2 -translate-x-1/2 hidden rounded-xl bg-zinc-800 border border-border px-4 py-2 text-sm">
    Copied!
  </div>

  <script>
    const $ = (s, r=document) => r.querySelector(s);
    const toast = $('#toast');
    const showToast = (msg='Copied!') => {
      toast.textContent = msg;
      toast.classList.remove('hidden');
      setTimeout(()=>toast.classList.add('hidden'), 1200);
    };

    // safer copy: read text from the <pre>, avoids template string escaping issues
    $('#copy')?.addEventListener('click', async () => {
      try { await navigator.clipboard.writeText($('#content').innerText); showToast('Text copied'); } catch {}
    });

    $('#copyLink')?.addEventListener('click', async () => {
      try { await navigator.clipboard.writeText(location.href); showToast('Link copied'); } catch {}
    });

    // print
    $('#print')?.addEventListener('click', () => window.print());

    // wrap toggle
    const pre = $('#content');
    $('#wrap')?.addEventListener('change', (e) => {
      pre.classList.toggle('whitespace-pre', !e.target.checked);
      pre.classList.toggle('whitespace-pre-wrap', e.target.checked);
    });

    // font size control
    const fs = $('#fontSize');
    const setSize = v => pre.style.fontSize = v + 'px';
    fs?.addEventListener('input', e => setSize(e.target.value));
    setSize(fs?.value || 16);
  </script>
</body>
</html>
